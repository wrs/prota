<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>objects-private2.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3-rc2 -->
<h1>objects-private2.h</h1><div class="fragment"><pre>00001 <span class="comment">/*</span>
00002 <span class="comment">    Prota language runtime</span>
00003 <span class="comment"></span>
00004 <span class="comment">    Private interface to the object system</span>
00005 <span class="comment"></span>
00006 <span class="comment">    Copyright 1997-1999 Walter R. Smith</span>
00007 <span class="comment">    Licensed under the MIT License. See LICENSE file in project root.</span>
00008 <span class="comment">*/</span>
00009 
00010 <span class="preprocessor">#ifndef __OBJECTS_PRIVATE_H__</span>
00011 <span class="preprocessor"></span><span class="preprocessor">#define __OBJECTS_PRIVATE_H__</span>
00012 <span class="preprocessor"></span>
00013 <span class="preprocessor">#include "objects.h"</span>
00014 
00015 <span class="keyword">struct </span>Object {
00016     UInt    size : 28;
00017     UInt    flags : 4;
00018     <span class="keyword">union </span>{
00019         Value   cls;
00020         Value   map;
00021         Object* pReplacement;
00022     };
00023     <span class="keyword">union </span>{
00024         <span class="keywordtype">void</span>*   pData;
00025         Value*  pSlots;
00026     };
00027 };
00028 
00029 <span class="keyword">enum</span> {
00030     HDR_SLOTTED = 1,
00031     HDR_FRAME = 2,
00032     HDR_FORWARDER = 4
00033 };
00034 
00035 <span class="keyword">inline</span>  ObjIsFrame(Object* pObj)
00036     { <span class="keywordflow">return</span> (pObj-&gt;flags &amp; (HDR_SLOTTED | HDR_FRAME)) == (HDR_SLOTTED | HDR_FRAME); }
00037 
00038 <span class="keyword">inline</span>  ObjIsArray(Object* pObj)
00039     { <span class="keywordflow">return</span> (pObj-&gt;flags &amp; (HDR_SLOTTED | HDR_FRAME)) == HDR_SLOTTED; }
00040 
00041 <span class="keyword">inline</span>  ObjIsBinary(Object* pObj)
00042     { <span class="keywordflow">return</span> (pObj-&gt;flags &amp; HDR_SLOTTED) == 0; }
00043 
00044 <span class="keyword">inline</span>  ObjIsSymbol(Object* pObj)
00045     { <span class="keywordflow">return</span> (pObj-&gt;flags &amp; HDR_SLOTTED) == 0 &amp;&amp; pObj-&gt;cls == SYMBOL_CLASS; }
00046 
00047 <span class="keyword">const</span> <span class="keywordtype">int</span> MAX_SLOTS = (1 &lt;&lt; 28) - 1;
00048 <span class="keyword">const</span> <span class="keywordtype">int</span> MAX_DATA = (1 &lt;&lt; 28) - 1;
00049 
00050 <span class="keyword">inline</span> Value PTR_V(<span class="keywordtype">void</span>* p) { <span class="keywordflow">return</span> (Value) (((int) p) | TAG_PTR); }
00051 Object* V_PTR(Value v);
00052 <span class="keyword">inline</span> Object* UNSAFE_V_PTR(Value v) { <span class="keywordflow">return</span> (Object*) (((int) v) - 1); }
00053 
00054 <span class="keyword">const</span> Value NATIVE_FN_CLASS = IMMED_V(IMMED_SPECIAL, 4);    <span class="comment">// a.k.a. 0x42</span>
00055 
00056 <span class="comment">// Map class flags (for the cls slot of map objects)</span>
00057 
00058 <span class="keyword">enum</span> {
00059     SORTED_MAP = 1,
00060     HASH_MAP = 2,
00061     HAS_PROTO = 4
00062 };
00063 
00064 <span class="keyword">const</span> Value SEQUENTIAL_MAP_CLASS = INT_V(0);
00065 <span class="keyword">const</span> Value HASH_MAP_CLASS = INT_V(HASH_MAP);
00066 
00067 <span class="keyword">struct </span>MapSlots {
00068     Value   supermap;
00069     <span class="keyword">union </span>{
00070         Value   tags[1];        <span class="comment">// for sequential maps</span>
00071         <span class="keyword">struct </span>{                <span class="comment">// for hash maps</span>
00072             Value   nOccupied;
00073             Value   table[1];
00074         };
00075     };
00076 };
00077 
00078 <span class="keywordtype">void</span>    SetSlottedLength(Object* pObj, <span class="keywordtype">int</span> nSlots);
00079 
00080 Value   GetMapTag(Value map, <span class="keywordtype">int</span> index);
00081 
00082 <span class="keyword">struct </span>SymbolData {
00083     <span class="keywordtype">int</span>     hash;
00084     <span class="keywordtype">char</span>    name[1];
00085 };
00086 
00087 <span class="keywordtype">void</span>    InternPredefSyms(Value syms[], <span class="keywordtype">int</span> len);
00088 
00089 <span class="preprocessor">#endif //__OBJECTS_PRIVATE_H__</span>
</pre></div><hr><address style="align: right;"><small>Generated on Wed Jan 29 21:59:24 2003 for Prota by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.3-rc2 </small></address>
</body>
</html>
