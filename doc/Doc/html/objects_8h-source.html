<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>objects.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3-rc2 -->
<h1>objects.h</h1><a href="objects_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/*</span>
00002 <span class="comment">    Prota language runtime</span>
00003 <span class="comment"></span>
00004 <span class="comment">    Object system interfaces</span>
00005 <span class="comment"></span>
00006 <span class="comment">    Copyright 1997-2000 Walter R. Smith</span>
00007 <span class="comment">    Licensed under the MIT License. See LICENSE file in project root.</span>
00008 <span class="comment">*/</span>
00009 
00010 <span class="preprocessor">#ifndef __OBJECTS_H__</span>
00011 <span class="preprocessor"></span><span class="preprocessor">#define __OBJECTS_H__</span>
00012 <span class="preprocessor"></span>
00015 <span class="preprocessor">#include "config.h"</span>
00016 <span class="preprocessor">#include "prota-errors.h"</span>
00017 
00023 
<a name="l00024"></a><a class="code" href="objects_8h.html#a5">00024</a> <span class="keyword">typedef</span> <span class="keyword">struct </span>_VALUE* <a class="code" href="objects_8h.html#a5">Value</a>;
00025 
00026 <span class="keyword">const</span> <span class="keywordtype">int</span> TAG_MASK = 3;
00027 <span class="keyword">enum</span> {
00028     TAG_INT,
00029     TAG_PTR,
00030     TAG_IMMED,
00031     TAG_MAGICPTR
00032 };
00033 
00034 <span class="keyword">const</span> <span class="keywordtype">int</span> IMMED_MASK = 0xC;
00035 <span class="keyword">enum</span> {
00036     IMMED_SPECIAL = 0,
00037     IMMED_CHAR = 4,
00038     IMMED_BOOLEAN = 8
00039 };
00040 
00041 <span class="preprocessor">#define MAKEVALUE(val, tag) ((Value) (((val) &lt;&lt; 2) | tag))</span>
00042 <span class="preprocessor"></span>
00043 <span class="preprocessor">#define IMMED_V(type, val) ((Value) (((val) &lt;&lt; 4) | (type) | TAG_IMMED))</span>
00044 <span class="preprocessor"></span>
00046 
<a name="l00047"></a><a class="code" href="objects_8h.html#a8">00047</a> <span class="keyword">const</span> <a class="code" href="objects_8h.html#a5">Value</a> <a class="code" href="objects_8h.html#a8">V_NIL</a> = IMMED_V(IMMED_SPECIAL, 0);  <span class="comment">// a.k.a. 2</span>
00048 
00050 
<a name="l00051"></a><a class="code" href="objects_8h.html#a9">00051</a> <span class="keyword">const</span> <a class="code" href="objects_8h.html#a5">Value</a> <a class="code" href="objects_8h.html#a9">V_TRUE</a> = IMMED_V(IMMED_BOOLEAN, 1); <span class="comment">// a.k.a. 0x1A</span>
00052 
00053 <span class="keyword">inline</span> <span class="keywordtype">int</span>      V_TAG(Value v)      { <span class="keywordflow">return</span> ((int) v) &amp; TAG_MASK; }
00054 
00058 
00060 
<a name="l00061"></a><a class="code" href="group__preds.html#a0">00061</a> <span class="keyword">inline</span> <span class="keywordtype">bool</span>     <a class="code" href="group__preds.html#a0">V_ISINT</a>(Value v)    { <span class="keywordflow">return</span> (V_TAG(v) == TAG_INT); }
00062 
00064 
<a name="l00065"></a><a class="code" href="group__preds.html#a1">00065</a> <span class="keyword">inline</span> <span class="keywordtype">bool</span>     <a class="code" href="group__preds.html#a1">V_ISPTR</a>(Value v)    { <span class="keywordflow">return</span> (V_TAG(v) &amp; TAG_PTR); }
00066 
00068 
<a name="l00069"></a><a class="code" href="group__preds.html#a2">00069</a> <span class="keyword">inline</span> <span class="keywordtype">bool</span>     <a class="code" href="group__preds.html#a2">V_ISCHAR</a>(Value v)   { <span class="keywordflow">return</span> (((int) v) &amp; (TAG_MASK | IMMED_MASK)) == (TAG_IMMED | IMMED_CHAR); }
00070 
00072 
00073 EXPORT  <span class="keywordtype">bool</span>    IsBinary(Value obj);
00074 
00076 
00077 EXPORT  <span class="keywordtype">bool</span>    IsArray(Value obj);
00078 
00080 
00081 EXPORT  <span class="keywordtype">bool</span>    IsFrame(Value obj);
00082 
00084 
00085 EXPORT  <span class="keywordtype">bool</span>    IsSymbol(Value obj);
00086 
00088 
00089 EXPORT  <span class="keywordtype">bool</span>    IsString(Value obj);
00090 
00092 
00101 
00103 
<a name="l00104"></a><a class="code" href="group__conversions.html#a0">00104</a> <span class="keyword">inline</span> <a class="code" href="objects_8h.html#a5">Value</a>    <a class="code" href="group__conversions.html#a0">INT_V</a>(<span class="keywordtype">int</span> i)            { <span class="keywordflow">return</span> MAKEVALUE(i, TAG_INT); }
00105 
00107 
<a name="l00108"></a><a class="code" href="group__conversions.html#a1">00108</a> <span class="keyword">inline</span> <a class="code" href="objects_8h.html#a5">Value</a>    <a class="code" href="group__conversions.html#a1">CHAR_V</a>(<span class="keywordtype">short</span> uc)        { <span class="keywordflow">return</span> IMMED_V(IMMED_CHAR, uc); }
00109 
00111 
<a name="l00112"></a><a class="code" href="group__conversions.html#a2">00112</a> <span class="keyword">inline</span> <a class="code" href="objects_8h.html#a5">Value</a>    <a class="code" href="group__conversions.html#a2">BOOL_V</a>(<span class="keywordtype">bool</span> b)          { <span class="keywordflow">return</span> b ? <a class="code" href="objects_8h.html#a9">V_TRUE</a> : <a class="code" href="objects_8h.html#a8">V_NIL</a>; }
00113 
00114 <span class="comment">// Constructs a "magic pointer" Value. Not currently used by anything.</span>
00115 
00116 <span class="keyword">inline</span> <a class="code" href="objects_8h.html#a5">Value</a>    MAGICPTR_V(<span class="keywordtype">int</span> index)   { <span class="keywordflow">return</span> IMMED_V(index, TAG_MAGICPTR); }
00117 
00119 
00120 EXPORT <a class="code" href="objects_8h.html#a5">Value</a>    REAL_V(<span class="keywordtype">double</span> d);
00121 
00122 EXPORT <span class="keywordtype">int</span> V_INT_error(<span class="keywordtype">void</span>);   <span class="comment">// Helper functions</span>
00123 EXPORT <span class="keywordtype">int</span> V_CHAR_error(<span class="keywordtype">void</span>);
00124 
00129 
<a name="l00130"></a><a class="code" href="group__conversions.html#a7">00130</a> <span class="keyword">inline</span> <span class="keywordtype">int</span>      <a class="code" href="group__conversions.html#a7">UNSAFE_V_INT</a>(Value v)   { <span class="keywordflow">return</span> (((int) v) &gt;&gt; 2); }
00131 
00133 
<a name="l00134"></a><a class="code" href="group__conversions.html#a8">00134</a> <span class="keyword">inline</span> <span class="keywordtype">int</span>      <a class="code" href="group__conversions.html#a8">V_INT</a>(Value v)          { <span class="keywordflow">return</span> <a class="code" href="group__preds.html#a0">V_ISINT</a>(v) ? (((int) v) &gt;&gt; 2) : V_INT_error(); }
00135 
00137 
<a name="l00138"></a><a class="code" href="group__conversions.html#a9">00138</a> <span class="keyword">inline</span> <span class="keywordtype">int</span>      <a class="code" href="group__conversions.html#a9">V_CHAR</a>(Value v)         { <span class="keywordflow">return</span> <a class="code" href="group__preds.html#a2">V_ISCHAR</a>(v) ? (((int) v) &gt;&gt; 4) : V_INT_error(); }
00139 
00141 
<a name="l00142"></a><a class="code" href="group__conversions.html#a10">00142</a> <span class="keyword">inline</span> <span class="keywordtype">bool</span>     <a class="code" href="group__conversions.html#a10">V_BOOL</a>(Value v)         { <span class="keywordflow">return</span> (v == <a class="code" href="objects_8h.html#a8">V_NIL</a>) ? <span class="keyword">false</span> : <span class="keyword">true</span>; }
00143 
00145 
00146 EXPORT <span class="keywordtype">double</span>   V_REAL(Value v);
00147 
00149 
00152 
00154 
<a name="l00155"></a><a class="code" href="structProtaException.html">00155</a> <span class="keyword">struct </span><a class="code" href="structProtaException.html">ProtaException</a> {
00156     <span class="keyword">const</span> <span class="keywordtype">char</span>* name;
00157     <a class="code" href="objects_8h.html#a5">Value</a>   data;
00158 
00160     <a class="code" href="structProtaException.html#a0">ProtaException</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* theName, <span class="keywordtype">int</span> err, Value theData);
00161 
<a name="l00163"></a><a class="code" href="structProtaException.html#a1">00163</a>     <a class="code" href="structProtaException.html#a0">ProtaException</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* theName, Value exObj)
00164         : name(theName), data(exObj)        { }
00165 
<a name="l00167"></a><a class="code" href="structProtaException.html#a2">00167</a>     <a class="code" href="structProtaException.html#a0">ProtaException</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* theName, <span class="keywordtype">int</span> err)
00168         : name(theName), data(<a class="code" href="group__conversions.html#a0">INT_V</a>(err))   { }
00169 };
00170 
00173 
<a name="l00174"></a><a class="code" href="group__exceptions.html#a1">00174</a> <span class="preprocessor">#define PROTA_THROW(name, err) throw ProtaException((name), (err))</span>
00175 <span class="preprocessor"></span><span class="preprocessor">#define PROTA_THROW_ERR(name, err, data) throw ProtaException((name), (err), (data))</span>
00176 <span class="preprocessor"></span>
00178 
00179 EXPORT  <span class="keywordtype">bool</span>    Subexception(<span class="keyword">const</span> <span class="keywordtype">char</span>* name1, <span class="keyword">const</span> <span class="keywordtype">char</span>* name2);
00180 
00184 
<a name="l00185"></a><a class="code" href="group__exnames.html#a0">00185</a> <span class="keyword">const</span> <span class="keywordtype">char</span>* <span class="keyword">const</span>   <a class="code" href="group__exnames.html#a0">g_exFr</a>      = <span class="stringliteral">"evt.ex.fr"</span>;              
<a name="l00186"></a><a class="code" href="group__exnames.html#a1">00186</a> <span class="keyword">const</span> <span class="keywordtype">char</span>* <span class="keyword">const</span>   <a class="code" href="group__exnames.html#a1">g_exIntrp</a>   = <span class="stringliteral">"evt.ex.fr.intrp"</span>;        
<a name="l00187"></a><a class="code" href="group__exnames.html#a2">00187</a> <span class="keyword">const</span> <span class="keywordtype">char</span>* <span class="keyword">const</span>   <a class="code" href="group__exnames.html#a2">g_exType</a>    = <span class="stringliteral">"evt.ex.fr.type"</span>;         
<a name="l00188"></a><a class="code" href="group__exnames.html#a3">00188</a> <span class="keyword">const</span> <span class="keywordtype">char</span>* <span class="keyword">const</span>   <a class="code" href="group__exnames.html#a3">g_exCompiler</a> = <span class="stringliteral">"evt.ex.fr.compiler"</span>;    
00189 
00192 
00194 
00195 EXPORT  <span class="keywordtype">void</span>    InitProtaLib(<span class="keywordtype">void</span>);
00196 
00199 
00200 EXPORT  <span class="keywordtype">bool</span>    V_EQ(Value a, Value b);
00201 
00204 
00206 
00207 EXPORT  <a class="code" href="objects_8h.html#a5">Value</a>   NewBinary(Value cls, <span class="keywordtype">int</span> size);
00208 
00210 
00211 EXPORT  <a class="code" href="objects_8h.html#a5">Value</a>   NewBinary(Value cls, <span class="keywordtype">void</span>* pData, <span class="keywordtype">int</span> size);
00212 
00214 
00215 EXPORT  <a class="code" href="objects_8h.html#a5">Value</a>   NewArray(Value cls, <span class="keywordtype">int</span> nSlots);
00216 
00218 
00219 EXPORT  <a class="code" href="objects_8h.html#a5">Value</a>   NewArray(<span class="keywordtype">int</span> nSlots);
00220 
00222 
00223 EXPORT  <a class="code" href="objects_8h.html#a5">Value</a>   <a class="code" href="group__alloc.html#a4">NewFrame</a>(<span class="keywordtype">void</span>);
00224 
00226 
00227 EXPORT  <a class="code" href="objects_8h.html#a5">Value</a>   NewMapWithTags(Value tagArray);
00228 
00230 
00231 EXPORT  <a class="code" href="objects_8h.html#a5">Value</a>   NewFrameWithMap(Value map);
00232 
00234 
00238 
00240 
00241 EXPORT  <a class="code" href="objects_8h.html#a5">Value</a>   GetSlot(Value array, <span class="keywordtype">int</span> index);
00242 
00244 
00245 EXPORT  <span class="keywordtype">void</span>    SetSlot(Value array, <span class="keywordtype">int</span> index, Value newValue);
00246 
00248 
00249 EXPORT  <a class="code" href="objects_8h.html#a5">Value</a>   GetSlot(Value frame, Value tag);
00250 
00252 
00253 EXPORT  <span class="keywordtype">void</span>    SetSlot(Value frame, Value tag, Value newValue);
00254 
00256 
00257 EXPORT  <span class="keywordtype">void</span>    RemoveSlot(Value frame, Value tag);
00258 
00260 
00261 EXPORT  <span class="keywordtype">bool</span>    HasSlot(Value frame, Value tag);
00262 
00264 
00265 EXPORT  <a class="code" href="objects_8h.html#a5">Value</a>   GetPath(Value obj, Value path);
00266 
00268 
00269 EXPORT  <span class="keywordtype">void</span>    SetPath(Value obj, Value path, Value newValue);
00270 
00272 
00273 EXPORT  <span class="keywordtype">bool</span>    HasPath(Value obj, Value path);
00274 
00276 
00277 EXPORT  <span class="keywordtype">void</span>*   GetData(Value binary);
00278 
00280 
00281 EXPORT  <a class="code" href="objects_8h.html#a5">Value</a>   GetClassSlot(Value obj);
00282 
00284 
00285 EXPORT  <span class="keywordtype">void</span>    SetClassSlot(Value obj, Value cls);
00286 
00288 
00289 EXPORT  <span class="keywordtype">void</span>    AddArraySlot(Value array, Value newValue);
00290 
00292 
00293 EXPORT  <a class="code" href="objects_8h.html#a5">Value</a>*  GetArraySlots(Value array);
00294 
00296 
00297 EXPORT  <span class="keywordtype">int</span>     GetArrayLength(Value array);
00298 
00300 
00301 EXPORT  <span class="keywordtype">void</span>    SetArrayLength(Value array, <span class="keywordtype">int</span> nSlots);
00302 
00304 
00305 EXPORT  <span class="keywordtype">int</span>     GetBinaryLength(Value binary);
00306 
00308 
00309 EXPORT  <span class="keywordtype">void</span>    SetBinaryLength(Value binary, <span class="keywordtype">int</span> size);
00310 
00313 
00314 EXPORT  <span class="keywordtype">int</span>     GetObjLength(Value obj);
00315 
00317 
00318 EXPORT  <a class="code" href="objects_8h.html#a5">Value</a>   Clone(Value obj);
00319 
00321 
00322 EXPORT  <a class="code" href="objects_8h.html#a5">Value</a>   DeepClone(Value obj);
00323 
00325 
00326 EXPORT  <span class="keywordtype">void</span>    ReplaceObject(Value oldObj, Value newObj);
00327 
00329 
00333 
00335 
00336 EXPORT  <a class="code" href="objects_8h.html#a5">Value</a>   Intern(<span class="keyword">const</span> <span class="keywordtype">char</span>* name);
00337 
00338 <span class="preprocessor">#define SYM(name) Intern(#name)</span>
00339 <span class="preprocessor"></span>
00341 
<a name="l00342"></a><a class="code" href="group__symfuncs.html#a1">00342</a> <span class="keyword">inline</span> <a class="code" href="objects_8h.html#a5">Value</a>    <a class="code" href="group__symfuncs.html#a1">MakeSymbol</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* name)    { <span class="keywordflow">return</span> Intern(name); }
00343 
00345 EXPORT  <span class="keyword">const</span> <span class="keywordtype">char</span>* SymbolName(Value sym);
00346 
00348 
00352 
00354 
00355 EXPORT  <a class="code" href="objects_8h.html#a5">Value</a>   NewString(<span class="keywordtype">int</span> size);
00356 
00358 
00359 EXPORT  <a class="code" href="objects_8h.html#a5">Value</a>   NewString(<span class="keyword">const</span> TCHAR* str);
00360 
00362 
00363 EXPORT  TCHAR*  GetCString(Value str);
00364 
00366 
00367 EXPORT  <span class="keywordtype">void</span>    StrAppend(Value str1, Value str2);
00368 
00370 
00372 
00373 EXPORT  <a class="code" href="objects_8h.html#a5">Value</a>   ReadStreamFile(<span class="keyword">const</span> <span class="keywordtype">char</span>* filename);
00374 
00378 
00380 
00381 EXPORT  <span class="keywordtype">void</span>    PrintValue(Value v);
00382 
00384 
00385 EXPORT  <span class="keywordtype">void</span>    SetMaxPrintDepth(<span class="keywordtype">int</span> maxDepth);
00386 
00388 
00389 EXPORT  <span class="keywordtype">void</span>    PrintValueLn(Value v);
00390 
00392 
00393 <span class="preprocessor">#endif //__OBJECTS_H__</span>
</pre></div><hr><address style="align: right;"><small>Generated on Sun Feb 9 20:47:37 2003 for Prota by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.3-rc2 </small></address>
</body>
</html>
