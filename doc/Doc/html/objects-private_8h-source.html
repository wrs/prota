<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>objects-private.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3-rc2 -->
<h1>objects-private.h</h1><div class="fragment"><pre>00001 <span class="comment">/*</span>
00002 <span class="comment">    Prota language runtime</span>
00003 <span class="comment"></span>
00004 <span class="comment">    Private interface to the object system</span>
00005 <span class="comment"></span>
00006 <span class="comment">    Copyright 1997-1999 Walter R. Smith</span>
00007 <span class="comment">    Licensed under the MIT License. See LICENSE file in project root.</span>
00008 <span class="comment">*/</span>
00009 
00010 <span class="preprocessor">#ifndef __OBJECTS_PRIVATE_H__</span>
00011 <span class="preprocessor"></span><span class="preprocessor">#define __OBJECTS_PRIVATE_H__</span>
00012 <span class="preprocessor"></span>
00013 <span class="preprocessor">#include "stddef.h"</span>
00014 <span class="preprocessor">#include "<a class="code" href="objects_8h.html">objects.h</a>"</span>
00015 
00016 <span class="keyword">struct </span>Object {
00017     UInt32  size : 28;
00018     UInt32  flags : 4;
00019     <span class="keyword">union </span>{
00020         <a class="code" href="objects_8h.html#a5">Value</a>   cls;
00021         <a class="code" href="objects_8h.html#a5">Value</a>   map;
00022         Object* pReplacement;
00023     };
00024     <span class="keyword">union </span>{
00025         <span class="keywordtype">void</span>*   pData;
00026         <a class="code" href="objects_8h.html#a5">Value</a>*  pSlots;
00027     };
00028 };
00029 
00030 <span class="keyword">enum</span> {
00031     HDR_SLOTTED = 1,
00032     HDR_FRAME = 2,
00033     HDR_FORWARDER = 4
00034 };
00035 
00036 <span class="keyword">const</span> <a class="code" href="objects_8h.html#a5">Value</a> FUNCTION_CLASS  = IMMED_V(IMMED_SPECIAL, 0x3);      <span class="comment">// a.k.a. 0x32</span>
00037 <span class="keyword">const</span> <a class="code" href="objects_8h.html#a5">Value</a> SYMBOL_CLASS    = IMMED_V(IMMED_SPECIAL, 0x5555);   <span class="comment">// a.k.a. 0x55552</span>
00038 <span class="keyword">const</span> <a class="code" href="objects_8h.html#a5">Value</a> NATIVE_FN_CLASS = IMMED_V(IMMED_SPECIAL, 4);        <span class="comment">// a.k.a. 0x42</span>
00039 
00040 <span class="keyword">inline</span> <span class="keywordtype">bool</span> ObjIsFrame(Object* pObj)
00041     { <span class="keywordflow">return</span> (pObj-&gt;flags &amp; (HDR_SLOTTED | HDR_FRAME)) == (HDR_SLOTTED | HDR_FRAME); }
00042 
00043 <span class="keyword">inline</span> <span class="keywordtype">bool</span> ObjIsArray(Object* pObj)
00044     { <span class="keywordflow">return</span> (pObj-&gt;flags &amp; (HDR_SLOTTED | HDR_FRAME)) == HDR_SLOTTED; }
00045 
00046 <span class="keyword">inline</span> <span class="keywordtype">bool</span> ObjIsBinary(Object* pObj)
00047     { <span class="keywordflow">return</span> (pObj-&gt;flags &amp; HDR_SLOTTED) == 0; }
00048 
00049 <span class="keyword">inline</span> <span class="keywordtype">bool</span> ObjIsSymbol(Object* pObj)
00050     { <span class="keywordflow">return</span> (pObj-&gt;flags &amp; HDR_SLOTTED) == 0 &amp;&amp; pObj-&gt;cls == SYMBOL_CLASS; }
00051 
00052 <span class="keyword">const</span> <span class="keywordtype">int</span> MAX_SLOTS = (1 &lt;&lt; 28) - 1;
00053 <span class="keyword">const</span> <span class="keywordtype">int</span> MAX_DATA = (1 &lt;&lt; 28) - 1;
00054 
00055 <span class="keyword">inline</span> <a class="code" href="objects_8h.html#a5">Value</a> PTR_V(<span class="keywordtype">void</span>* p) { <span class="keywordflow">return</span> (Value) (((int) p) | TAG_PTR); }
00056 Object* V_PTR(Value v);
00057 <span class="keyword">inline</span> Object* UNSAFE_V_PTR(Value v) { <span class="keywordflow">return</span> (Object*) (((int) v) - 1); }
00058 
00059 <span class="comment">// Map class flags (for the cls slot of map objects)</span>
00060 
00061 <span class="keyword">enum</span> {
00062     SORTED_MAP = 1,
00063     HASH_MAP = 2,
00064     HAS_PROTO = 4,
00065     SHARED_MAP = 8
00066 };
00067 
00068 <span class="keyword">const</span> <a class="code" href="objects_8h.html#a5">Value</a> SEQUENTIAL_MAP_CLASS = <a class="code" href="group__conversions.html#a0">INT_V</a>(0);
00069 <span class="keyword">const</span> <a class="code" href="objects_8h.html#a5">Value</a> HASH_MAP_CLASS = <a class="code" href="group__conversions.html#a0">INT_V</a>(HASH_MAP);
00070 
00071 <span class="keyword">struct </span>MapSlots {
00072     <a class="code" href="objects_8h.html#a5">Value</a>   supermap;
00073     <span class="keyword">union </span>{
00074         <a class="code" href="objects_8h.html#a5">Value</a>   tags[1];        <span class="comment">// for sequential maps</span>
00075         <span class="keyword">struct </span>{                <span class="comment">// for hash maps</span>
00076             <a class="code" href="objects_8h.html#a5">Value</a>   nOccupied;
00077             <a class="code" href="objects_8h.html#a5">Value</a>   table[1];
00078         } hash;
00079     };
00080 };
00081 
00082 <span class="keyword">inline</span> <span class="keywordtype">int</span> SeqMapArraySize(<span class="keywordtype">int</span> nSlots) { <span class="keywordflow">return</span> offsetof(MapSlots, tags[nSlots]) / <span class="keyword">sizeof</span>(Value); }
00083 <span class="keyword">inline</span> <span class="keywordtype">int</span> HashMapArraySize(<span class="keywordtype">int</span> nSlots) { <span class="keywordflow">return</span> offsetof(MapSlots, hash.table[nSlots]) / <span class="keyword">sizeof</span>(Value); }
00084 
00085 <span class="keywordtype">void</span>    SetSlottedLength(Object* pObj, <span class="keywordtype">int</span> nSlots);
00086 
00087 <a class="code" href="objects_8h.html#a5">Value</a>   GetMapTag(Value map, <span class="keywordtype">int</span> index);
00088 
00089 <span class="keyword">struct </span>SymbolData {
00090     <span class="keywordtype">int</span>     hash;
00091     <span class="keywordtype">char</span>    name[1];
00092 };
00093 
00094 <span class="keywordtype">void</span>    InternPredefSyms(Value syms[], <span class="keywordtype">int</span> len);
00095 
00096 <span class="preprocessor">#endif //__OBJECTS_PRIVATE_H__</span>
</pre></div><hr><address style="align: right;"><small>Generated on Sun Feb 9 20:47:36 2003 for Prota by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.3-rc2 </small></address>
</body>
</html>
